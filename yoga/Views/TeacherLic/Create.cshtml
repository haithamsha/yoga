@inject Microsoft.AspNetCore.Mvc.Localization.IViewLocalizer localizer

@model yoga.ViewModels.TechearMemberShipVM
@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@inject UserManager<AppUser> userManager
@{
    var user = await userManager.GetUserAsync(User);
    var imagePath = user.UserImage;
}


<div class="container mt-5">
    <h2>@localizer["PageTitle"]</h2>

    <!-- Display validation summary -->
    <div asp-validation-summary="All" class="text-danger"></div>

    <form id="masterForm" asp-action="Create" enctype="multipart/form-data">
        <!-- Master Data Section -->
        <div class="card mb-4">
            <div class="card-header">
                <h5></h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label asp-for="EducationLevel">@localizer["EducationLevel"]</label>
                    <select name="EducationLevel" id="EducationLevel" class="form-control"
                            asp-for="EducationLevel" asp-items="@Model.EducationLevels">
                    </select>
                    <span asp-validation-for="EducationLevel" class="text-danger"></span>
                </div>
                <div class="mb-3">
                    <label asp-for="SocialMediaAccounts">@localizer["SocialMediaAccounts"]</label>
                    <input asp-for="SocialMediaAccounts" class="form-control" />
                    <span asp-validation-for="SocialMediaAccounts" class="text-danger"></span>
                </div>
                <div class="mb-3">
                    <label asp-for="PersonalWebSite">@localizer["PersonalWebSite"]</label>
                    <input asp-for="PersonalWebSite" class="form-control" />
                    <span asp-validation-for="PersonalWebSite" class="text-danger"></span>
                </div>
                <div class="mb-3">
                    <label asp-for="ExpYears">@localizer["YearsOfExperience"]</label>
                    <input asp-for="ExpYears" class="form-control" type="number" />
                    <span asp-validation-for="ExpYears" class="text-danger"></span>
                </div>
            </div>
        </div>

        <!-- Detail Data Section -->
        <div class="card mb-4">
            <div class="card-header">
                <h5>@localizer["DetailData"]</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <thead class="table-dark">
                            <tr>
                                <th>@localizer["TeachingType"]</th>
                                <th>@localizer["AccreditedHours"]</th>
                                <th>@localizer["SchoolLocation"]</th>
                                <th>@localizer["CertaficateDate"]</th>
                                <th>@localizer["SchoolName"]</th>
                                <th>@localizer["Schoollink"]</th>
                                <th>@localizer["SchoolSocialMediaAccount"]</th>
                                <th>@localizer["CertificateFile"]</th>
                                <th>@localizer["Actions"]</th>
                            </tr>
                        </thead>
                        <tbody id="TechearMemberShipTestVMsTableBody">
                            <!-- Dynamic detail rows will be inserted here -->
                        </tbody>
                    </table>
                </div>
                <button type="button" class="btn btn-outline-success mt-3" id="addDetailRow">
                    <i class="bi bi-plus-circle"></i> @localizer["Add"]
                </button>
            </div>
        </div>

        <!-- Form Actions -->
        <div class="mb-3">
            <input id="ckAgreement" asp-for="Agreement" name="Agreement" type="checkbox"> <span class="fw-bold">
                <a target="_blank" asp-action="Policy" asp-controller="Home">@localizer["Agreement"]</a>
            </span>
            <span asp-validation-for="@Model.Agreement" class="text-danger"></span>

        </div>
        <div class="d-flex justify-content-end">
            <input type="submit" value='@localizer["Submit"]' class="btn btn-primary me-2" />
            
        </div>
        <div style="height:50px"></div>
    </form>
</div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.3/dist/jquery.validate.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery-validation-unobtrusive@3.2.11/dist/jquery.validate.unobtrusive.min.js"></script>
    <script>
        $(document).ready(function () {
            $('#addDetailRow').click(function () {
                var rowCount = $('#TechearMemberShipTestVMsTableBody tr').length;
                var newRow = `<tr>
                                    <td><select name="TechearMemberShipTestVMs[${rowCount}].TeachingType" class="form-select" required>
                                            <option value="">Select</option>
                                            <option value="1">Yin</option>
                                            <option value="2">Prenatal</option>
                                            <option value="3">Therapy</option>
                                            <option value="4">Aerial</option>
                                            <option value="5">Hatha</option>
                                            <option value="6">Ashtanga</option>
                                            <option value="7">Vinyasa Flow</option>
                                            <option value="8">Iyengar</option>
                                        </select><span class="text-danger" data-valmsg-for="TechearMemberShipTestVMs[${rowCount}].TeachingType" data-valmsg-replace="true"></span></td>
                                    <td><input type="number" name="TechearMemberShipTestVMs[${rowCount}].AccreditedHours" class="form-control" required />
                                        <span class="text-danger" data-valmsg-for="TechearMemberShipTestVMs[${rowCount}].AccreditedHours" data-valmsg-replace="true"></span></td>
                                    <td><input type="text" name="TechearMemberShipTestVMs[${rowCount}].SchoolLocation" class="form-control" required />
                                        <span class="text-danger" data-valmsg-for="TechearMemberShipTestVMs[${rowCount}].SchoolLocation" data-valmsg-replace="true"></span></td>
                                    <td><input type="date" name="TechearMemberShipTestVMs[${rowCount}].CertificateDate" class="form-control" required />
                                        <span class="text-danger" data-valmsg-for="TechearMemberShipTestVMs[${rowCount}].CertificateDate" data-valmsg-replace="true"></span></td>
                                    <td><input type="text" name="TechearMemberShipTestVMs[${rowCount}].SchoolName" class="form-control" required />
                                        <span class="text-danger" data-valmsg-for="TechearMemberShipTestVMs[${rowCount}].SchoolName" data-valmsg-replace="true"></span></td>
                                    <td><input type="text" name="TechearMemberShipTestVMs[${rowCount}].SchoolLink" class="form-control" />
                                        <span class="text-danger" data-valmsg-for="TechearMemberShipTestVMs[${rowCount}].SchoolLink" data-valmsg-replace="true"></span></td>
                                    <td><input type="text" name="TechearMemberShipTestVMs[${rowCount}].SchoolSocialMediaAccount" class="form-control" /></td>
                                            <td><input type="file" name="CertficateFiles" class="form-control" required />
                                                <span class="text-danger" data-valmsg-for="TechearMemberShipTestVMs[${rowCount}].CertficateFiles" data-valmsg-replace="true"></span></td>
                                    <td><button type="button" class="btn btn-outline-danger removeDetailRow"><i class="bi bi-trash"></i> Remove</button></td>
                                </tr>`;
                $('#TechearMemberShipTestVMsTableBody').append(newRow);
                // Re-apply validation to new elements
                $.validator.unobtrusive.parse('#TechearMemberShipTestVMsTableBody');
            });

            $(document).on('click', '.removeDetailRow', function () {
                $(this).closest('tr').remove();
                updateRowIndices();
            });

            function updateRowIndices() {
                $('#TechearMemberShipTestVMsTableBody tr').each(function (index, row) {
                    $(row).find('input, select').each(function () {
                        var name = $(this).attr('name');
                        if (name) {
                            var newName = name.replace(/\[\d+\]/, `[${index}]`);
                            $(this).attr('name', newName);
                        }
                    });
                });
                // Re-apply validation to updated elements
                $.validator.unobtrusive.parse('#TechearMemberShipTestVMsTableBody');
            }

            $('#masterForm').submit(function (e) {
                var isValid = true;
                

                if (!jQuery("#ckAgreement").is(":checked")) {
                    alert("ERROR! Please Accept the agreement");
                    isValid = false;
                }
                

                if (!isValid) {
                    e.preventDefault();
                }
            });
        });
    </script>
}